<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cell Preview - Decision-Making Experiment</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .preview-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .cell-preview {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .cell-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .cell-header h2 {
      margin: 0 0 10px 0;
      font-size: 24px;
    }
    
    .cell-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .info-item {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 6px;
    }
    
    .info-item strong {
      display: block;
      color: #667eea;
      margin-bottom: 5px;
    }
    
    .preview-section {
      margin: 25px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .preview-section h3 {
      color: #667eea;
      margin-top: 0;
      margin-bottom: 15px;
    }
    
    .logic-box {
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      border: 1px solid #ddd;
    }
    
    .logic-box code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    
    .before-decision, .after-decision {
      margin: 20px 0;
    }
    
    .simulated-data {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
    
    .simulated-data table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .simulated-data th, .simulated-data td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    .simulated-data th {
      background: #667eea;
      color: white;
    }
    
    .team-ranking {
      background: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
    
    .stability-info {
      background: #d1ecf1;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
    
    .toggle-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    
    .toggle-btn:hover {
      background: #5568d3;
    }
    
    .hidden-section {
      display: none;
    }
    
    .screen-mockup {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }
    
    .screen-mockup-content {
      background: white;
      border-radius: 8px;
      padding: 25px;
      min-height: 400px;
    }
    
    .mockup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .mockup-header-left {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .mockup-round {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .mockup-timer {
      font-size: 16px;
      color: #e74c3c;
    }
    
    .mockup-header-right {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .mockup-id {
      font-size: 14px;
      color: #666;
    }
    
    .mockup-tokens {
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
    }
    
    .mockup-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .mockup-tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 16px;
      color: #666;
    }
    
    .mockup-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: bold;
    }
    
    .mockup-decision-section {
      text-align: center;
      padding: 30px;
    }
    
    .mockup-decision-section h3 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 22px;
    }
    
    .mockup-slider-container {
      margin: 30px 0;
    }
    
    .mockup-slider {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      margin: 20px 0;
      position: relative;
    }
    
    .mockup-slider-track {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 50%;
      border-radius: 4px;
    }
    
    .mockup-slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    
    .mockup-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    
    .mockup-btn {
      padding: 10px 20px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .mockup-btn.active {
      background: #667eea;
      color: white;
    }
    
    .mockup-summary {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .mockup-summary-item {
      text-align: center;
    }
    
    .mockup-summary-item span {
      display: block;
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
      margin-top: 5px;
    }
    
    .mockup-submit-btn {
      padding: 15px 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }
    
    .mockup-results {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .mockup-results h3 {
      color: #667eea;
      margin-bottom: 20px;
    }
    
    .mockup-results-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    
    .mockup-result-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .mockup-result-item .label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .mockup-result-item .value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .mockup-leaderboard {
      margin: 20px 0;
    }
    
    .mockup-leaderboard h3 {
      color: #667eea;
      margin-bottom: 15px;
    }
    
    .mockup-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .mockup-table thead {
      background: #667eea;
      color: white;
    }
    
    .mockup-table th,
    .mockup-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .mockup-table tbody tr:hover {
      background: #f8f9fa;
    }
    
    .mockup-table tbody tr.highlight {
      background: #e3f2fd;
      font-weight: bold;
    }
    
    .mockup-social-norm {
      background: #e8f4f8;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .mockup-social-norm h4 {
      color: #667eea;
      margin-bottom: 15px;
    }
    
    .mockup-social-norm-stats {
      display: flex;
      gap: 30px;
    }
    
    .mockup-social-norm-stat {
      text-align: center;
    }
    
    .mockup-social-norm-stat .label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .mockup-social-norm-stat .value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="preview-container">
    <div class="cell-header" style="margin-bottom: 30px;">
      <h1>Cell Preview - Decision-Making Experiment</h1>
      <p>This page shows what participants see in each of the 14 experiment cells, including all logic for simulated contributions, team rankings, and stability.</p>
    </div>
    
    <div id="cellsContainer"></div>
  </div>
  
  <script>
    // Define all 14 cells
    const BETWEEN_SUBJECT_CELLS = [
      // Cell 1-7: Focal user 85% rounds LOWER than average
      { cellNumber: 1, infoType: 'noInfo', focalUserContributionLevel: 'lower' },
      { cellNumber: 2, infoType: 'teamLB', focalUserContributionLevel: 'lower' },
      { cellNumber: 3, infoType: 'indLBWithin', focalUserContributionLevel: 'lower' },
      { cellNumber: 4, infoType: 'bothLBWithin', focalUserContributionLevel: 'lower' },
      { cellNumber: 5, infoType: 'bothLBAcross', focalUserContributionLevel: 'lower' },
      { cellNumber: 6, infoType: 'socialNorm', focalUserContributionLevel: 'lower' },
      { cellNumber: 7, infoType: 'indLBAcross', focalUserContributionLevel: 'lower' },
      
      // Cell 8-14: Focal user 85% rounds HIGHER than average
      { cellNumber: 8, infoType: 'noInfo', focalUserContributionLevel: 'higher' },
      { cellNumber: 9, infoType: 'teamLB', focalUserContributionLevel: 'higher' },
      { cellNumber: 10, infoType: 'indLBWithin', focalUserContributionLevel: 'higher' },
      { cellNumber: 11, infoType: 'bothLBWithin', focalUserContributionLevel: 'higher' },
      { cellNumber: 12, infoType: 'bothLBAcross', focalUserContributionLevel: 'higher' },
      { cellNumber: 13, infoType: 'socialNorm', focalUserContributionLevel: 'higher' },
      { cellNumber: 14, infoType: 'indLBAcross', focalUserContributionLevel: 'higher' },
    ];
    
    const infoTypeLabels = {
      'noInfo': 'No Info',
      'teamLB': 'Team Leaderboard Only',
      'indLBWithin': 'Individual Leaderboard (Within Team) Only',
      'bothLBWithin': 'Both Team & Individual Leaderboard (Within Team)',
      'bothLBAcross': 'Both Team & Individual Leaderboard (Across Teams)',
      'socialNorm': 'Social Norm (Average Team & Own)',
      'indLBAcross': 'Individual Leaderboard (Across Teams) Only'
    };
    
    // Generate preview for all cells
    function generateCellPreviews() {
      const container = document.getElementById('cellsContainer');
      
      BETWEEN_SUBJECT_CELLS.forEach(cell => {
        const cellDiv = document.createElement('div');
        cellDiv.className = 'cell-preview';
        cellDiv.id = `cell-${cell.cellNumber}`;
        
        const focalLabel = cell.focalUserContributionLevel === 'lower' 
          ? '85% Rounds Lower Than Average' 
          : '85% Rounds Higher Than Average';
        
        cellDiv.innerHTML = `
          <div class="cell-header">
            <h2>Cell ${cell.cellNumber}: ${infoTypeLabels[cell.infoType]} | ${focalLabel}</h2>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <button class="toggle-btn" onclick="toggleSection('before-${cell.cellNumber}')">Show Before Decision</button>
              <button class="toggle-btn" onclick="toggleSection('after-${cell.cellNumber}')">Show After Decision</button>
              <button class="toggle-btn" onclick="toggleSection('logic-${cell.cellNumber}')">Show Logic</button>
            </div>
          </div>
          
          <div class="cell-info">
            <div class="info-item">
              <strong>Info Type:</strong>
              ${infoTypeLabels[cell.infoType]}
            </div>
            <div class="info-item">
              <strong>Focal User Level:</strong>
              ${focalLabel}
            </div>
            <div class="info-item">
              <strong>Test URL:</strong>
              <code>?cell=${cell.cellNumber}</code>
            </div>
          </div>
          
          <!-- Before Decision -->
          <div id="before-${cell.cellNumber}" class="preview-section hidden-section">
            <h3>üìã What User Sees BEFORE Making Decision</h3>
            ${generateBeforeDecisionView(cell)}
          </div>
          
          <!-- After Decision -->
          <div id="after-${cell.cellNumber}" class="preview-section hidden-section">
            <h3>‚úÖ What User Sees AFTER Making Decision</h3>
            ${generateAfterDecisionView(cell)}
          </div>
          
          <!-- Logic -->
          <div id="logic-${cell.cellNumber}" class="preview-section hidden-section">
            <h3>‚öôÔ∏è Experiment Logic for This Cell</h3>
            ${generateLogicExplanation(cell)}
          </div>
        `;
        
        container.appendChild(cellDiv);
      });
    }
    
    function generateBeforeDecisionView(cell) {
      let html = '<div class="before-decision">';
      
      // Visual mockup of the screen
      html += `
        <div class="screen-mockup">
          <div class="screen-mockup-content">
            <!-- Header -->
            <div class="mockup-header">
              <div class="mockup-header-left">
                <div class="mockup-round">Round 1 of 10</div>
                <div class="mockup-timer">Time Remaining: 01:52</div>
              </div>
              <div class="mockup-header-right">
                <div class="mockup-id">ID: UID-1234567890-ABCDEF</div>
                <div class="mockup-tokens">Your Tokens: 20</div>
              </div>
            </div>
            
            <!-- Tabs -->
            <div class="mockup-tabs">
              <button class="mockup-tab active">Decision</button>
              <button class="mockup-tab">Leaderboard</button>
            </div>
            
            <!-- Decision Section -->
            <div class="mockup-decision-section">
              <h3>Make Your Decision</h3>
              <p style="color: #666; margin-bottom: 20px;">How many tokens do you want to contribute to the group project?</p>
              
              <!-- Slider -->
              <div class="mockup-slider-container">
                <div class="mockup-slider">
                  <div class="mockup-slider-track"></div>
                </div>
                <div class="mockup-slider-labels">
                  <span>0</span>
                  <span style="font-weight: bold; color: #667eea;">10</span>
                  <span>20</span>
                </div>
              </div>
              
              <!-- Quick buttons -->
              <div class="mockup-buttons">
                <button class="mockup-btn">0</button>
                <button class="mockup-btn">5</button>
                <button class="mockup-btn active">10</button>
                <button class="mockup-btn">15</button>
                <button class="mockup-btn">20</button>
              </div>
              
              <!-- Summary -->
              <div class="mockup-summary">
                <div class="mockup-summary-item">
                  <div>You contribute:</div>
                  <span>10</span> tokens
                </div>
                <div class="mockup-summary-item">
                  <div>You keep:</div>
                  <span>10</span> tokens
                </div>
              </div>
              
              <!-- Submit button -->
              <button class="mockup-submit-btn">SUBMIT DECISION</button>
            </div>
            
            ${generateBeforeDecisionInfo(cell)}
          </div>
        </div>
      `;
      
      html += '</div>';
      return html;
    }
    
    function generateBeforeDecisionInfo(cell) {
      switch(cell.infoType) {
        case 'noInfo':
          return '';
          
        case 'teamLB':
        case 'indLBWithin':
        case 'bothLBWithin':
        case 'bothLBAcross':
        case 'indLBAcross':
          return `
            <div style="margin-top: 30px; padding: 15px; background: #f0f7ff; border-radius: 8px; border-left: 4px solid #667eea;">
              <strong>‚ÑπÔ∏è Leaderboard Available</strong>
              <p style="margin: 10px 0 0 0; color: #666;">Switch to the "Leaderboard" tab to view rankings.</p>
            </div>
          `;
          
        case 'socialNorm':
          return `
            <div class="mockup-social-norm">
              <h4>Team Statistics</h4>
              <div class="mockup-social-norm-stats">
                <div class="mockup-social-norm-stat">
                  <div class="label">Team Average</div>
                  <div class="value">${cell.focalUserContributionLevel === 'lower' ? '14-18' : '14-18'}</div>
                </div>
              </div>
            </div>
          `;
          
        default:
          return '';
      }
    }
    
    function generateAfterDecisionView(cell) {
      let html = '<div class="after-decision">';
      
      // Visual mockup of the screen after decision
      html += `
        <div class="screen-mockup">
          <div class="screen-mockup-content">
            <!-- Header -->
            <div class="mockup-header">
              <div class="mockup-header-left">
                <div class="mockup-round">Round 1 of 10</div>
                <div class="mockup-timer" style="color: #27ae60;">Round Complete</div>
              </div>
              <div class="mockup-header-right">
                <div class="mockup-id">ID: UID-1234567890-ABCDEF</div>
                <div class="mockup-tokens">Your Tokens: 20</div>
              </div>
            </div>
            
            <!-- Tabs -->
            <div class="mockup-tabs">
              <button class="mockup-tab">Decision</button>
              <button class="mockup-tab active">Leaderboard</button>
            </div>
            
            <!-- Results Section -->
            <div class="mockup-results">
              <h3>Round Results</h3>
              <div class="mockup-results-grid">
                <div class="mockup-result-item">
                  <div class="label">Your Contribution</div>
                  <div class="value">10</div>
                  <div style="font-size: 12px; color: #666;">tokens</div>
                </div>
                <div class="mockup-result-item">
                  <div class="label">Group Total</div>
                  <div class="value">65</div>
                  <div style="font-size: 12px; color: #666;">tokens</div>
                </div>
                <div class="mockup-result-item">
                  <div class="label">Your Share</div>
                  <div class="value">10.8</div>
                  <div style="font-size: 12px; color: #666;">tokens</div>
                </div>
                <div class="mockup-result-item">
                  <div class="label">Your Payoff</div>
                  <div class="value">20.8</div>
                  <div style="font-size: 12px; color: #666;">tokens</div>
                </div>
              </div>
              <div style="text-align: center; margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                <strong style="color: #27ae60;">Cumulative Payoff: 20.8 tokens</strong>
              </div>
            </div>
            
            ${generateAfterDecisionInfo(cell)}
          </div>
        </div>
      `;
      
      html += '</div>';
      return html;
    }
    
    function generateAfterDecisionInfo(cell) {
      switch(cell.infoType) {
        case 'noInfo':
          return '';
          
        case 'teamLB':
          return `
            <div class="mockup-leaderboard">
              <h3>Team Leaderboard</h3>
              <table class="mockup-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Team</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="highlight">
                    <td>1</td>
                    <td><strong>Your Team</strong></td>
                    <td>65</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Team 1</td>
                    <td>58</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>Team 2</td>
                    <td>52</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>Team 3</td>
                    <td>45</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>Team 4</td>
                    <td>38</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          
        case 'indLBWithin':
          return `
            <div class="mockup-leaderboard">
              <h3>Individual Leaderboard (Your Team)</h3>
              <table class="mockup-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Member</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Team Member 3</td>
                    <td>15</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Team Member 1</td>
                    <td>12</td>
                  </tr>
                  <tr class="highlight">
                    <td>3</td>
                    <td><strong>You</strong></td>
                    <td>10</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>Team Member 2</td>
                    <td>8</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>Team Member 4</td>
                    <td>6</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          
        case 'bothLBWithin':
          return `
            <div class="mockup-leaderboard">
              <h3>Team Leaderboard</h3>
              <table class="mockup-table" style="margin-bottom: 30px;">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Team</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="highlight">
                    <td>1</td>
                    <td><strong>Your Team</strong></td>
                    <td>65</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Team 1</td>
                    <td>58</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>Team 2</td>
                    <td>52</td>
                  </tr>
                </tbody>
              </table>
              
              <h3>Individual Leaderboard (Your Team)</h3>
              <table class="mockup-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Member</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Team Member 3</td>
                    <td>15</td>
                  </tr>
                  <tr class="highlight">
                    <td>2</td>
                    <td><strong>You</strong></td>
                    <td>10</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>Team Member 1</td>
                    <td>8</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          
        case 'bothLBAcross':
          return `
            <div class="mockup-leaderboard">
              <h3>Team Leaderboard</h3>
              <table class="mockup-table" style="margin-bottom: 30px;">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Team</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="highlight">
                    <td>1</td>
                    <td><strong>Your Team</strong></td>
                    <td>65</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Team 1</td>
                    <td>58</td>
                  </tr>
                </tbody>
              </table>
              
              <h3>Individual Leaderboard (All Teams)</h3>
              <table class="mockup-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Participant</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Team Member 5</td>
                    <td>18</td>
                  </tr>
                  <tr class="highlight">
                    <td>5</td>
                    <td><strong>You</strong></td>
                    <td>10</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>Team Member 2</td>
                    <td>9</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          
        case 'socialNorm':
          return `
            <div class="mockup-social-norm">
              <h4>Team Statistics</h4>
              <div class="mockup-social-norm-stats">
                <div class="mockup-social-norm-stat">
                  <div class="label">Team Average</div>
                  <div class="value">${cell.focalUserContributionLevel === 'lower' ? '14-18' : '14-18'}</div>
                </div>
              </div>
            </div>
          `;
          
        case 'indLBAcross':
          return `
            <div class="mockup-leaderboard">
              <h3>Individual Leaderboard (All Teams)</h3>
              <table class="mockup-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Participant</th>
                    <th>Total Contribution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Team Member 5</td>
                    <td>18</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Team Member 3</td>
                    <td>15</td>
                  </tr>
                  <tr class="highlight">
                    <td>5</td>
                    <td><strong>You</strong></td>
                    <td>10</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
          
        default:
          return '';
      }
    }
    
    function getLeaderboardInfo(infoType) {
      switch(infoType) {
        case 'teamLB':
          return '<ul><li>Team leaderboard with top 10 teams</li><li>Your team highlighted</li></ul>';
        case 'indLBWithin':
          return '<ul><li>Individual leaderboard within your team (6 members)</li></ul>';
        case 'bothLBWithin':
          return '<ul><li>Team leaderboard</li><li>Individual leaderboard within team</li></ul>';
        case 'bothLBAcross':
          return '<ul><li>Team leaderboard</li><li>Individual leaderboard across all teams</li></ul>';
        case 'indLBAcross':
          return '<ul><li>Individual leaderboard across all teams (top 20)</li></ul>';
        default:
          return '';
      }
    }
    
    function generateLogicExplanation(cell) {
      let html = '<div class="logic-explanation">';
      
      // Focal user contribution logic
      html += `
        <div class="logic-box">
          <strong>Focal User Contribution Level Logic:</strong>
          <p><code>focalUserContributionLevel: "${cell.focalUserContributionLevel}"</code></p>
          <ul>
            <li><strong>Target:</strong> Focal user should be in ${cell.focalUserContributionLevel === 'lower' ? 'bottom 3 ranks (ranks 4, 5, or 6)' : 'top 3 ranks (ranks 1, 2, or 3)'} in 85% of rounds</li>
            <li><strong>Implementation:</strong> Simulated team members adjust their contributions to ensure focal user achieves target rank position</li>
            <li><strong>Rank Positioning:</strong> 
              ${cell.focalUserContributionLevel === 'lower' 
                ? 'At least 3 simulated members contribute 3-8 tokens more than user to ensure user ranks 4th, 5th, or 6th'
                : 'At most 2 simulated members contribute 1-4 tokens more than user, remaining members contribute 3-8 tokens less to ensure user ranks 1st, 2nd, or 3rd'}
            </li>
            <li><strong>Compliance:</strong> Tracks rounds to ensure 85% compliance (allows 15% variation where user can be anywhere)</li>
          </ul>
        </div>
      `;
      
      // Simulated contributions
      html += `
        <div class="simulated-data">
          <strong>Simulated Team Member Contributions:</strong>
          <ul>
            <li><strong>Group Size:</strong> 6 members total (1 focal user + 5 simulated)</li>
            <li><strong>Base Contributions:</strong> Simulated members contribute 8-15 tokens on average</li>
            <li><strong>Adjustment:</strong> Contributions adjusted to ensure focal user is in ${cell.focalUserContributionLevel === 'lower' ? 'bottom 3 ranks (4, 5, or 6)' : 'top 3 ranks (1, 2, or 3)'} in 85% of rounds</li>
            <li><strong>Rank Positioning:</strong> 
              ${cell.focalUserContributionLevel === 'lower' 
                ? 'At least 3 simulated members contribute 3-8 tokens more than user'
                : 'At most 2 simulated members contribute 1-4 tokens more, remaining contribute 3-8 tokens less'}
            </li>
            <li><strong>Individual LB Stability:</strong> 
              <ul>
                <li>High stability: Maintain ranks for 50% of rounds</li>
                <li>Low stability: Maintain ranks for 50% of rounds (same for both, but different implementation)</li>
                <li>Rank maintenance: High contributors stay high, low contributors stay low</li>
              </ul>
            </li>
          </ul>
          
          <table>
            <thead>
              <tr>
                <th>Member</th>
                <th>Base Contribution</th>
                <th>Adjusted Contribution</th>
                <th>Logic</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>You (Focal)</td>
                <td>User Input</td>
                <td>User Input</td>
                <td>No adjustment</td>
              </tr>
              <tr>
                <td>Team Member 1</td>
                <td>8-15 tokens</td>
                <td>Adjusted based on focal</td>
                <td>${cell.focalUserContributionLevel === 'lower' ? '3-8 tokens more (to rank above)' : '3-8 tokens less (to rank below)'}</td>
              </tr>
              <tr>
                <td>Team Member 2</td>
                <td>8-15 tokens</td>
                <td>Adjusted based on focal</td>
                <td>${cell.focalUserContributionLevel === 'lower' ? '3-8 tokens more (to rank above)' : '3-8 tokens less (to rank below)'}</td>
              </tr>
              <tr>
                <td>Team Member 3</td>
                <td>8-15 tokens</td>
                <td>Adjusted based on focal</td>
                <td>${cell.focalUserContributionLevel === 'lower' ? '3-8 tokens more (to rank above)' : '3-8 tokens less (to rank below)'}</td>
              </tr>
              <tr>
                <td>Team Member 4</td>
                <td>8-15 tokens</td>
                <td>Adjusted based on focal</td>
                <td>${cell.focalUserContributionLevel === 'lower' ? '3-8 tokens more (to rank above)' : '3-8 tokens less (to rank below)'}</td>
              </tr>
              <tr>
                <td>Team Member 5</td>
                <td>8-15 tokens</td>
                <td>Adjusted based on focal</td>
                <td>${cell.focalUserContributionLevel === 'lower' ? '3-8 tokens more (to rank above)' : '3-8 tokens less (to rank below)'}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
      
      // Team ranking logic
      html += `
        <div class="team-ranking">
          <strong>Team Ranking Logic:</strong>
          <ul>
            <li><strong>Total Teams:</strong> 10 teams (configurable in admin)</li>
            <li><strong>Team Contribution Factor (Within-Subject):</strong>
              <ul>
                <li><strong>High:</strong> Your team appears in top 25% of teams</li>
                <li><strong>Low:</strong> Your team appears in bottom 25% of teams</li>
              </ul>
            </li>
            <li><strong>Team LB Stability (Within-Subject):</strong>
              <ul>
                <li><strong>High:</strong> Team rank maintained for 50% of rounds</li>
                <li><strong>Low:</strong> Team rank maintained for 50% of rounds</li>
                <li>When not maintained, rank can vary within the target range (top 25% or bottom 25%)</li>
              </ul>
            </li>
            <li><strong>Implementation:</strong> Simulated teams created with adjusted totals to position focal team correctly</li>
            <li><strong>Team Naming:</strong> Focal team = "Your Team", Others = "Team 1", "Team 2", etc.</li>
          </ul>
        </div>
      `;
      
      // Within-subject factors
      html += `
        <div class="stability-info">
          <strong>Within-Subject Factors (Randomized Per Round):</strong>
          <ul>
            <li><strong>Team Contribution:</strong> High (top 25%) or Low (bottom 25%) - randomized per round</li>
            <li><strong>Individual LB Stability:</strong> High (50% maintain) or Low (50% maintain) - randomized per round</li>
            <li><strong>Team LB Stability:</strong> High (50% maintain) or Low (50% maintain) - randomized per round</li>
            <li><strong>Randomization:</strong> All 8 combinations (2√ó2√ó2) randomly assigned across rounds</li>
            <li><strong>Order Effect:</strong> Sequence shuffled to mitigate order effects</li>
          </ul>
        </div>
      `;
      
      ${cell.infoType === 'socialNorm' ? `
        <div class="logic-box">
          <strong>Social Norm Logic:</strong>
          <ul>
            <li><strong>Target Average (Condition-Based):</strong>
              <ul>
                <li><strong>High Team Rank:</strong> Target average = 16 tokens (configurable via admin, default: 16)</li>
                <li><strong>Low Team Rank:</strong> Target average = 6 tokens (configurable via admin, default: 6)</li>
                <li><strong>Variation:</strong> +/-2 tokens applied to target (e.g., 14-18 for high, 4-8 for low)</li>
              </ul>
            </li>
            <li><strong>Individual Contribution Adjustment:</strong>
              <ul>
                <li>Total needed = (Target Average √ó Group Size) - Focal User Contribution</li>
                <li>Average per simulated member = Total Needed / Number of Simulated Members</li>
                <li>Each simulated contribution = Average + random(-1 to +1) variation</li>
                <li>Contributions adjusted to ensure team average matches target</li>
              </ul>
            </li>
            <li><strong>Display:</strong> Only team average is shown to users (standard deviation is calculated but not displayed)</li>
            <li><strong>Admin Configuration:</strong> Administrators can set socialNormAverageHigh, socialNormAverageLow, and socialNormStdDev</li>
          </ul>
        </div>
      ` : ''}
      
      // Data storage
      html += `
        <div class="logic-box">
          <strong>Data Storage for This Cell:</strong>
          <ul>
            <li><strong>Participant Record:</strong> Stores between-subject cell (${cell.cellNumber}), infoType, focalUserContributionLevel</li>
            <li><strong>Contributions:</strong> Each contribution stores treatmentConditions with all factors</li>
            <li><strong>Payoffs:</strong> Each payoff stores treatmentConditions with all factors</li>
            <li><strong>Round Data:</strong> Comprehensive round data stored including:
              <ul>
                <li>All team member contributions and ranks (including simulated)</li>
                <li>All team totals and ranks</li>
                <li>Individual ranks within team</li>
                <li>Team ranks across all teams</li>
              </ul>
            </li>
            <li><strong>Cell Assignment:</strong> Tracked in cellAssignments collection</li>
          </ul>
        </div>
      `;
      
      html += '</div>';
      return html;
    }
    
    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.toggle('hidden-section');
      }
    }
    
    // Generate all previews on page load
    document.addEventListener('DOMContentLoaded', () => {
      generateCellPreviews();
    });
  </script>
</body>
</html>

